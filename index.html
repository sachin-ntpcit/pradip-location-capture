<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PRADIP ‚Äì Data Centre Infrastructure Update</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
    font-family:'Segoe UI',Tahoma,Verdana,sans-serif;
    background:linear-gradient(135deg,#1e3c72,#2a5298);
    min-height:100vh;
    padding:20px
}
.container{max-width:900px;margin:auto}
.card{
    background:#fff;
    border-radius:16px;
    box-shadow:0 20px 60px rgba(0,0,0,.3);
    padding:40px;
    text-align:center
}
h1{color:#1e3c72;margin-bottom:15px}
.subtitle{color:#666;margin-bottom:25px}
.btn{
    padding:14px 32px;
    border:none;
    border-radius:8px;
    font-size:16px;
    font-weight:600;
    cursor:pointer;
    margin:10px;
    color:#fff
}
.btn-primary{background:#1e3c72}
.btn-secondary{background:#6c757d}
.btn-success{background:#28a745}
.btn-primary:hover,.btn-success:hover{opacity:.9}
.hidden{display:none}
.address-box{
    background:#f8f9fa;
    border-radius:10px;
    padding:15px;
    text-align:left;
    margin-top:15px;
    font-size:14px
}
iframe{
    width:100%;
    min-height:720px;
    border:none;
    border-radius:16px
}
.note{
    margin-top:10px;
    font-size:13px;
    color:#555
}
</style>
</head>

<body>
<div class="container">

<!-- LOCATION STEP -->
<div id="locationCard" class="card">
    <h1>üìç Capture Location (Optional)</h1>
    <p class="subtitle">
        You may capture your GPS location.  
        <br>If location is not allowed (iPhone), you can still continue.
    </p>

    <button class="btn btn-primary" onclick="captureLocation()">Capture Location</button>
    <button class="btn btn-secondary" onclick="continueToForm()">Skip & Continue</button>

    <div id="locationResult" class="hidden address-box"></div>
    <div class="note">Location is optional. Form submission will work without it.</div>
</div>

<!-- FORM STEP -->
<div id="formCard" class="card hidden">
    <h1>üìù PRADIP ‚Äì Infrastructure Update</h1>
    <p class="subtitle">Please fill the form below</p>
    <iframe id="googleForm"></iframe>
</div>

</div>

<script>
/* ================= CONFIGURATION ================= */

const GOOGLE_FORM_URL =
  'https://forms.gle/nquHqjLsmBAgmfMN7';

const GOOGLE_APPS_SCRIPT_URL =
  'https://script.google.com/macros/s/AKfycbzHzIbJqPTFi3NGwqOKFUH5iGOkVCY_dA8Y3xAK04DDXUgnYiXihdpayeOolizE1EiOWQ/exec';   // <-- REQUIRED

const SESSION_ENTRY_ID =
  'entry.1679097510';              // <-- Session ID entry

/* ================================================ */

// Generate session ID (always)
const sessionId =
  'SID-' + Date.now() + '-' + Math.floor(Math.random()*100000);

// Load form with session ID
document.getElementById('googleForm').src =
  GOOGLE_FORM_URL + '?' + SESSION_ENTRY_ID + '=' + sessionId;

let locationSent = false;

/* Capture Location (OPTIONAL) */
function captureLocation() {

  if (!navigator.geolocation) {
    alert('GPS not supported. Continuing without location.');
    continueToForm();
    return;
  }

  navigator.geolocation.getCurrentPosition(async pos => {

    const lat = pos.coords.latitude;
    const lon = pos.coords.longitude;

    let address = `Lat: ${lat}, Lng: ${lon}`;

    try {
      const res = await fetch(
        `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`,
        { headers:{'User-Agent':'PRADIP-App'} }
      );
      const data = await res.json();
      if (data.display_name) address = data.display_name;
    } catch(e){}

    // Send to Apps Script
    fetch(GOOGLE_APPS_SCRIPT_URL,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({
        sessionId: sessionId,
        address: address
      })
    });

    locationSent = true;

    document.getElementById('locationResult').classList.remove('hidden');
    document.getElementById('locationResult').innerHTML =
      `<strong>Captured Location:</strong><br>${address}`;

  }, () => {
    alert('Location not allowed. Continuing without location.');
    continueToForm();
  },{
    enableHighAccuracy:true,
    timeout:15000,
    maximumAge:0
  });
}

/* Continue to Form */
function continueToForm(){
  document.getElementById('locationCard').classList.add('hidden');
  document.getElementById('formCard').classList.remove('hidden');
}
</script>

</body>
</html>

